#include "../wu-ftpd.h"

char *
realpath(const char *pathname, char *result, char* chroot_path)
{
  char curpath[MAXPATHLEN],
    workpath[MAXPATHLEN],
    namebuf[MAXPATHLEN];

  if (result == NULL)
    return(NULL);

  if(pathname == NULL){
    *result = EOS; 
    return(NULL);
  }

  workpath[MAXPATHLEN-1] = EOS;
  strcpy(curpath, pathname);
  strcpy(namebuf, workpath);

  /* OK */
  r_strncat(namebuf, curpath, MAXPATHLEN-strlen(namebuf)-1);

  return result;
}

int main ()
{
  char pathname [MAXPATHLEN];
  char result [MAXPATHLEN];
  char chroot_path [MAXPATHLEN];

  /* Don't use too big a pathname; we're not trying to overflow curpath */
#ifdef __FRAMAC__
  // pathname must be initialized to avoid UB
  Frama_C_make_unknown(pathname, MAXPATHLEN-1);
#endif
  pathname [MAXPATHLEN-1] = EOS;
#ifdef __FRAMAC__
  // result must be initialized to avoid UB
  Frama_C_make_unknown(result, MAXPATHLEN-1);
#endif
  result [MAXPATHLEN-1] = EOS;
#ifdef __FRAMAC__
  // chroot_path must be initialized to avoid UB
  Frama_C_make_unknown(chroot_path, MAXPATHLEN-1);
#endif
  chroot_path [MAXPATHLEN-1] = EOS;


  realpath(pathname, result, chroot_path);

  return 0;
}
